#!/usr/bin/env node

var fs = require('fs');
var spawn = require('child_process').spawn;
var chalk = require('chalk');
var inquirer = require('inquirer');
var log = console.log;
var scripts = require(process.cwd() + '/package.json').scripts;

/**
 * list to be prompted
 */
var list = [{
  type: 'list',
  name: 'scripts',
  message: 'which script you\'d like to execute?',
  choices: []
}];

/**
 * padding
 */
console.log();
process.on('exit', function () {
  console.log();
});

/**
 * read the scripts and show it to users
 */
if (scripts === undefined) {
  log(chalk.red('   no script was ever defined!'));
} else {
  for (var i in scripts) {
    list[0].choices.push(`${i} # -> ${scripts[i]}`);
  }
  // 弹出提示给用户选择命令
  inquirer.prompt(list).then(answers => {
    const name = answers.scripts.slice(0, answers.scripts.indexOf('#')).trim();
    spawn('npm', ['run', name], {
      stdio: 'inherit'
    });
  });
}
